const express = require('express');
const archiver = require('archiver');
const path = require('path');
const fs = require('fs');
const app = express();

app.post('/projects/:projectId/downloadFolder', (req, res) => {
const projectId = req.params.projectId;
const folderPath = req.body.path;

const absoluteFolderPath = path.join(__dirname, 'projects', projectId, folderPath);

if (!fs.existsSync(absoluteFolderPath)) {
return res.status(404).send('Папка не найдена.');
}

res.setHeader('Content-Disposition', `attachment; filename=${path.basename(folderPath)}.zip`);
res.setHeader('Content-Type', 'application/zip');

const archive = archiver('zip', {
zlib: { level: 9 } // Сжатие
});

archive.directory(absoluteFolderPath, false);

archive.on('error', err => {
throw err;
});

archive.pipe(res);
archive.finalize();
});
