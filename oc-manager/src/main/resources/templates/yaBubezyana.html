<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Compiler</title>
    <link rel="stylesheet" th:href="@{/style.css}" href="/style.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="icon" type="image/png" href="/favicon.png" sizes="180x180">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="projectId" th:content="${projectId}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background-color: #E6EEF5;
            padding: 20px;
        }

        #editor-container {
            height: 500px;
            border: 1px solid grey;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        #files-container {
            height: 500px;
            background-color: #F9FBFC;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            padding: 15px;
        }

        .top-buttons .btn {
            margin-right: 10px;
            border-radius: 15px;
        }

        #output {
            margin-top: 20px;
            padding: 15px;
            background-color: #F7F9FA;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
        }

        .top-buttons .btn {
            margin-left: 5px;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: background-color 0.3s;
        }

        .top-buttons .btn-secondary:hover {
            background-color: #E0E0E0;
            border-radius: 15px;
        }

        .top-buttons .btn-success:hover {
            background-color: #1AAE48;
        }

        .user-name {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            text-decoration: none;
            cursor: default;
        }

        #languageSelect {
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .container-fluid {
            background-color: #FFFFFF;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-group button {
            transition: background-color 0.3s;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            justify-content: center;
            align-items: center;
            z-index: 1000; /* –ü–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        }

        .modal-message {
            background-color: rgba(144, 238, 144, 0.5); /* –ó–µ–ª–µ–Ω–æ–≤–∞—Ç—ã–π —Ü–≤–µ—Ç —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 50%; /* –£–≤–µ–ª–∏—á–∏–ª–∏ —à–∏—Ä–∏–Ω—É –æ–∫–Ω–∞ */
        }

        .file-item-container {
            padding: 10px;
            margin: 5px 0;
            background-color: #f9fbfc;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .file-item-container:hover {
            background-color: #e0e0e0;
        }

        .file-item-container.active {
            background-color: #d0d0d0;
        }

        .folder-item-container {
            position: relative;
            margin-left: 10px;
            padding: 5px;
            cursor: pointer;
        }

        .folder-item-container::before {
            content: "üìÅ ";
            display: inline-block;
            margin-right: 5px;
        }

        .folder-item-container.open::before {
            content: "üìÇ ";
        }

        .file-item-container {
            margin-left: 30px;
            padding: 5px;
        }

        .folder-item-container .folder-name,
        .file-item-container .file-name {
            display: inline-block;
        }

        .folder-item-container .folder-name:hover,
        .file-item-container .file-name:hover {
            text-decoration: underline;
            cursor: pointer;
        }

    </style>
</head>
<body>
<div class="container-fluid">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏ –≤—ã–±–æ—Ä–æ–º —è–∑—ã–∫–∞ -->
    <div class="row align-items-center mb-3">
        <div class="col">
            <h3 sec:authorize="!isAuthenticated()" class="user-name">Online Compiler</h3>
            <a href="/userProfile" sec:authorize="isAuthenticated()" sec:authentication="name" class="user-name"></a>
        </div>

        <div class="col text-right">
            <!-- –ö–Ω–æ–ø–∫–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <div class="btn-group top-buttons" role="group">
                <button class="btn btn-primary" onclick="saveProject()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                    <i class="fas fa-save"></i>
                </button>
                <button class="btn btn-secondary" onclick="downloadFile()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª">
                    <i class="fas fa-download"></i>
                </button>
                <button class="btn btn-secondary" onclick="uploadFile()" title="–í—ã–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª">
                    <i class="fas fa-upload"></i>
                </button>
                <meta name="_csrf" th:content="${_csrf.token}"/>
                <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
                <button class="btn btn-success" onclick="submitCode()">
                    <i class="fas fa-play"></i>
                </button>
                <button class="btn btn-secondary" onclick="uploadFolder()" title="–í—ã–≥—Ä—É–∑–∏—Ç—å –ø–∞–ø–∫—É">
                    <i class="fas fa-folder-open"></i>
                </button>
                <form sec:authorize="!isAuthenticated()" th:action="@{/login}" th:method="GET">
                    <button type="submit" class="btn btn-secondary">–í–æ–π—Ç–∏</button>
                </form>
                <form sec:authorize="isAuthenticated()" th:action="@{/logout}" th:method="POST">
                    <button type="submit" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
                </form>
            </div>
            <div id="message-container"></div>
        </div>
        <!-- –í—ã–±–æ—Ä —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="col-md-2">
            <select id="languageSelect" class="form-control d-inline-block" onchange="setLanguage(this.value)">
                <option value="java">Java</option>
                <option value="python3">Python3</option>
                <option value="cpp">C++</option>
            </select>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="row">
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ñ–∞–π–ª–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="col-md-3">
            <div id="files-container">
                <p>–í–∞—à–∏ —Ñ–∞–π–ª—ã</p>
            </div>
        </div>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –∫–æ–¥–∞ -->
        <div class="col-md-9">
            <div id="editor-container"></div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div class="row">
        <div class="col">
            <div id="output" class="output-container">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
            </div>
        </div>
    </div>

    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-message">
            –í–∞—à –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!
        </div>
    </div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.28.1/min/vs/loader.min.js"></script>
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º scripts.js –ø–µ—Ä–µ–¥ —Å–∫—Ä–∏–ø—Ç–æ–º —Å –≤—ã–∑–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–π -->
<script th:src="@{/scripts.js}" src="/scripts.js"></script>
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function() {
        window.files = /*[[${files}]]*/ [];
        window.projectId = /*[[${projectId}]]*/ 0;

        console.log("–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤:", window.files);
        window.files.forEach(fileName => addFileToContainer(fileName));
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function showSuccessMessage(message) {
        const modal = document.getElementById('successModal');
        const modalMessage = modal.querySelector('.modal-message');
        modalMessage.textContent = message;

        modal.style.display = 'flex'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

        // –£–±–∏—Ä–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            modal.style.display = 'none';
        }, 3000);
    }
</script>

</body>
</html>











const templates = {
"java": `public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, Java!");\n    }\n}`,
"cpp": `#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello, C++!" << endl;\n    return 0;\n}`,
    "python3": `print("Hello, Python!")`
    };

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.files –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    window.files = [];  // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    window.openFiles = {};  // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
    let editor;
    let models = {}; // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞

    function addFileToContainer(fileName) {
    console.log("–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª:", fileName);
    const filesContainer = document.getElementById('files-container');

    const fileElement = document.createElement('div');
    fileElement.classList.add('file-item-container');

    const fileNameSpan = document.createElement('span');
    fileNameSpan.textContent = fileName;
    fileNameSpan.classList.add('file-name');

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ñ–∞–π–ª—É –¥–ª—è –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
    fileElement.addEventListener('click', () => {
    openFile(fileName);  // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    highlightActiveFile(fileElement);  // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    });

    fileElement.appendChild(fileNameSpan);
    filesContainer.appendChild(fileElement);
    }

    function openFile(fileName) {
    const currentFileName = getCurrentFileName();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
    if (currentFileName && openFiles[currentFileName]) {
    openFiles[currentFileName] = editor.getValue();
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    if (openFiles[fileName]) {
    editor.setValue(openFiles[fileName]);
    } else {
    const projectId = window.projectId;  // –ò—Å–ø–æ–ª—å–∑—É–µ–º window.projectId
    fetch(`/projects/${projectId}/files/${fileName}`)
    .then(response => {
    if (!response.ok) {
    throw new Error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ${response.statusText}`);
    }
    return response.text();
    })
    .then(content => {
    editor.setValue(content);
    openFiles[fileName] = content;
    })
    .catch(error => {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:', error);
    });
    }

    highlightActiveFileByName(fileName);
    }

    function highlightActiveFile(selectedFileElement) {
    const fileItems = document.querySelectorAll('.file-item-container');
    fileItems.forEach(item => item.classList.remove('active'));  // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ

    selectedFileElement.classList.add('active');  // –í—ã–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Monaco Editor
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.28.1/min/vs' }});
    require(['vs/editor/editor.main'], function() {
    // –°–æ–∑–¥–∞—ë–º –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏
    models['java'] = monaco.editor.createModel(templates['java'], 'java');
    models['cpp'] = monaco.editor.createModel(templates['cpp'], 'cpp');
    models['python3'] = monaco.editor.createModel(templates['python3'], 'python');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å –º–æ–¥–µ–ª—å—é Java –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    editor = monaco.editor.create(document.getElementById('editor-container'), {
    model: models['java'],
    theme: 'vs-dark'
    });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
    function setLanguage(language) {
    editor.pushUndoStop();  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
    const currentModel = models[language];
    editor.setModel(currentModel);  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –º–æ–¥–µ–ª—å
    editor.pushUndoStop();  // –í–∫–ª—é—á–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤
    function addFile(fileName, content) {
    window.files.push({ fileName, content });
    }




    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    function highlightActiveFileByName(fileName) {
    const fileItems = document.querySelectorAll('.file-item-container');
    fileItems.forEach(item => {
    const itemName = item.querySelector('.file-name').textContent;
    if (itemName === fileName) {
    item.classList.add('active');
    } else {
    item.classList.remove('active');
    }
    });
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function getCurrentFileName() {
    return document.querySelector('.file-item-container.active .file-name')?.textContent || null;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–∞–π–ª–æ–≤
    function uploadFile() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.txt,.java,.py,.cpp';

    input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();

    reader.onload = event => {
    const content = event.target.result;
    const fileName = file.name;

    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –º–∞—Å—Å–∏–≤
    addFile(fileName, content);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
    openFiles[fileName] = content;

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
    editor.setValue(content);

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ñ–∞–π–ª–æ–≤
    addFileToContainer(fileName);
    };
    reader.readAsText(file);
    };
    input.click();
    }




    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
    function downloadFile() {
    const content = editor.getValue();
    const blob = new Blob([content], { type: 'text/plain' });

    const link = document.createElement('a');
    link.download = `${getCurrentFileName()}`;
    link.href = window.URL.createObjectURL(blob);
    link.click();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
    async function saveProject() {
    const language = document.getElementById('languageSelect').value;

    // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤–µ —Ñ–∞–π–ª–æ–≤
    const currentFileName = getCurrentFileName();
    const currentContent = editor.getValue();
    updateFileContent(currentFileName, currentContent);

    // –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –º–µ—Ç–∞—Ç–µ–≥–æ–≤
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

    const projectId = window.projectId;

    if (!projectId) {
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞.");
    return;
    }

    try {
    // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
    const formData = new FormData();

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤ FormData
    files.forEach(file => {
    const blob = new Blob([file.content], { type: 'text/plain' });
    formData.append('files', blob, file.fileName);
    });

    // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—É—Ç—å, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ
    formData.append('path', ''); // –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è

    const response = await fetch(`/projects/${projectId}/save`, {
    method: 'POST',
    headers: {
    [csrfHeader]: csrfToken
    },
    body: formData
    });

    if (response.ok) {
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
    showSuccessMessage("–í–∞—à –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
    } else {
    const errorText = await response.text();
    showErrorMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞: ${errorText}`);
    }
    } catch (error) {
    showErrorMessage(`–û—à–∏–±–∫–∞: ${error.message}`);
    }
    }


    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    async function submitCode() {
    const language = document.getElementById('languageSelect').value;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    const currentFileName = getCurrentFileName();
    const currentContent = editor.getValue();
    updateFileContent(currentFileName, currentContent);

    // –ü–æ–ª—É—á–∞–µ–º CSRF-—Ç–æ–∫–µ–Ω –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –º–µ—Ç–∞—Ç–µ–≥–æ–≤
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

    try {
    const response = await fetch('http://localhost:8080/compile', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json',
    [csrfHeader]: csrfToken  // –î–æ–±–∞–≤–ª—è–µ–º CSRF-—Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
    },
    body: JSON.stringify({
    files: files,
    language: language
    })
    });

    if (!response.ok) {
    throw new Error('Network response was not ok');
    }

    const result = await response.text();
    document.getElementById('output').textContent = result || "No errors, code executed successfully!";
    } catch (error) {
    document.getElementById('output').textContent = `Error: ${error.message}`;
    }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤ –º–∞—Å—Å–∏–≤–µ —Ñ–∞–π–ª–æ–≤
    function updateFileContent(fileName, newContent) {
    const file = window.files.find(file => file.fileName === fileName);
    if (file) {
    file.content = newContent;
    }
    window.openFiles[fileName] = newContent;  // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    function showSuccessMessage(message) {
    const messageContainer = document.getElementById('message-container');
    messageContainer.innerHTML = `<div class="alert alert-success">${message}</div>`;
    setTimeout(() => {
    messageContainer.innerHTML = '';
    }, 5000); // –°–æ–æ–±—â–µ–Ω–∏–µ –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    }
    document.addEventListener('click', function(event) {
    if (event.target.classList.contains('folder-name') || event.target.classList.contains('folder-arrow')) {
    const folderElement = event.target.closest('.folder-item-container');  // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–∞–ø–∫–∏
    const arrowElement = folderElement.querySelector('.folder-arrow');  // –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É
    const folderChildren = folderElement.querySelectorAll('.file-item-container, .folder-item-container');

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫)
    folderChildren.forEach(child => {
    child.style.display = (child.style.display === 'none') ? 'block' : 'none';
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–µ–ª–æ—á–∫–∏ –∏ –∏–∫–æ–Ω–∫–∏
    arrowElement.classList.toggle('open');  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å open –¥–ª—è —Å—Ç—Ä–µ–ª–æ—á–∫–∏
    folderElement.classList.toggle('open');  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å open –¥–ª—è –ø–∞–ø–∫–∏
    }
    });

    function uploadFolder() {
    const input = document.createElement('input');
    input.type = 'file';
    input.webkitdirectory = true;
    input.multiple = true;

    input.onchange = async (event) => {
    const files = event.target.files;

    for (let file of files) {
    const reader = new FileReader();
    reader.onload = function (e) {
    const content = e.target.result;
    const filePath = file.webkitRelativePath;  // –≠—Ç–æ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏

    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤
    addFile(filePath, content);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
    openFiles[filePath] = content;

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ñ–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
    addFileToContainer(filePath);
    };
    reader.readAsText(file);
    }
    };

    input.click();
    }
    function addFileToContainer(filePath) {
    const filesContainer = document.getElementById('files-container');

    const pathParts = filePath.split('/'); // –†–∞–∑–±–∏–≤–∞–µ–º –ø—É—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ (–ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª)
    let currentElement = filesContainer;

    pathParts.forEach((part, index) => {
    if (index === pathParts.length - 1) {
    // –≠—Ç–æ —Ñ–∞–π–ª, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç
    const fileElement = document.createElement('div');
    fileElement.classList.add('file-item-container');

    const fileNameSpan = document.createElement('span');
    fileNameSpan.textContent = part;  // –¢–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞
    fileNameSpan.classList.add('file-name');

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞
    fileElement.addEventListener('click', () => {
    openFile(filePath);  // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    highlightActiveFile(fileElement);  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞–π–ª
    });

    fileElement.appendChild(fileNameSpan);
    currentElement.appendChild(fileElement);
    } else {
    // –≠—Ç–æ –ø–∞–ø–∫–∞, —Å–æ–∑–¥–∞–µ–º –µ–µ, –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
    let folderElement = currentElement.querySelector(`[data-folder="${part}"]`);

    if (!folderElement) {
    folderElement = document.createElement('div');
    folderElement.classList.add('folder-item-container');
    folderElement.setAttribute('data-folder', part); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞–ø–∫–∏

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É –ø–µ—Ä–µ–¥ –ø–∞–ø–∫–æ–π
    const arrowIcon = document.createElement('i');
    arrowIcon.classList.add('fas', 'fa-caret-right', 'folder-arrow');

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–ø–∫–∏
    const folderNameSpan = document.createElement('span');
    folderNameSpan.textContent = part;  // –ò–º—è –ø–∞–ø–∫–∏
    folderNameSpan.classList.add('folder-name');
    folderNameSpan.style.fontWeight = 'bold';  // –í—ã–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É –∂–∏—Ä–Ω—ã–º

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –∏ –ø–∞–ø–∫—É –≤ —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    folderElement.appendChild(arrowIcon);
    folderElement.appendChild(folderNameSpan);
    currentElement.appendChild(folderElement);
    }

    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –ø–∞–ø–∫–∏
    currentElement = folderElement;
    }
    });
    }


    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
    function showErrorMessage(message) {
    const messageContainer = document.getElementById('message-container');
    messageContainer.innerHTML = `<div class="alert alert-danger">${message}</div>`;
    setTimeout(() => {
    messageContainer.innerHTML = '';
    }, 5000);
    }

